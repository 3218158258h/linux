
### 一、编译的概念澄清
广义上的“编译”包含三个阶段：预处理（.c→.i）、编译（狭义，.i→.s，将预处理文件转为汇编语言）、汇编（.s→.o，生成机器码目标文件）；最终通过链接阶段将.o文件组合为可执行文件。


### 二、常用编译选项
#### 1. 基础编译
- **生成可执行文件**：`gcc source.c -o output`（默认生成a.out，-o指定输出文件名）

#### 2. 多阶段控制（对应广义编译流程）
- **预处理（.c→.i）**：`gcc -E source.c -o source.i`（生成预处理文件，展开头文件和宏）
- **编译（狭义，.i→.s）**：`gcc -S source.c -o source.s`（生成汇编文件）
- **汇编（.s→.o）**：`gcc -c source.c -o source.o`（生成目标文件）

#### 3. 警告与调试
- **开启所有警告**：`gcc -Wall source.c`（提示潜在问题，推荐常规使用）
- **生成调试信息**：`gcc -g source.c`（保留调试符号，供gdb调试）

#### 4. 优化与标准
- **代码优化**：`gcc -O2 source.c`（-O1基础优化，-O3最高级优化）
- **指定C标准**：`gcc -std=c99 source.c`（如c99、c11等）

#### 5. 链接选项
- **链接外部库**：`gcc source.c -lm`（-lm链接数学库libm）
- **多文件链接**：`gcc file1.c file2.c -o program`（一次性编译并链接多个源文件）


### 三、各阶段问题与调试
#### 1. 预处理阶段（.c→.i）
- **关键问题**：头文件找不到、宏展开错误、条件编译异常（库文件/宏错误在此阶段）。
- **调试操作**：用`gcc -E`生成.i文件，直接查看头文件是否展开、宏是否正确替换。

#### 2. 编译阶段（.i→.s）
- **关键问题**：语法错误（如少分号）、变量类型不匹配（语法错误主要在此阶段）。
- **调试操作**：用`gcc -S`生成.s文件，通过终端报错定位语法问题；或阅读汇编代码验证逻辑。

#### 3. 汇编阶段（.s→.o）
- **关键问题**：跨平台架构不匹配、汇编指令兼容问题（少见）。
- **调试操作**：用`objdump -f 目标文件.o`查架构；`objdump -d 目标文件.o`反汇编验证机器码。

#### 4. 链接阶段（.o→可执行文件）
- **关键问题**：“undefined reference”（找不到函数实现）、依赖库缺失。
- **调试操作**：用`-lm`等选项链接库；`ldd 可执行文件`查缺失共享库；`nm 目标文件/库`确认符号是否存在。


### 四、调试核心逻辑
根据gcc报错信息定位阶段（如“#include错误”→预处理，“undefined reference”→链接），再用对应阶段的选项（`-E`/`-S`）和工具（`objdump`/`ldd`/`nm`）查看中间产物，逐步缩小问题范围。
